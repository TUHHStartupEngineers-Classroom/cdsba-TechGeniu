{
  "hash": "495eb9a304ff0b0b6fbda6a22766a3f1",
  "result": {
    "markdown": "---\ntitle: \"Instrumental Variables\"\nauthor: \"Sriramkumar Sarida\"\n---\n\n\n# Study of New Pop up for the existing App data base users\n\n------------------------------------------------------------------------\n\n## Draw DAG\n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-1_f10cb947b5114764bdd8c35534a068d5'}\n\n```{.r .cell-code}\nlibrary(dagitty)\nlibrary(ggdag)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attaching package: 'ggdag'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> The following object is masked from 'package:stats':\n#> \n#>     filter\n```\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\n\niv_expl <- dagify(\n  Y ~ D,\n  Y ~ U,\n  D ~ U,\n  D ~ Z,\n  exposure = \"D\",\n  latent = \"U\",\n  outcome = \"Y\",\n  coords = list(x = c(U = 1, D = 0, Y = 2, Z = -1),\n                y = c(U = 1, D = 0, Y = 0, Z = 0)),\n  labels = c(\"D\" = \"Pop-up Feature\", \n             \"Y\" = \"App Usage\", \n             \"U\" = \"Unobserved Factor\",\n             \"Z\" = \"Encouragement\")\n)\nggdag(iv_expl, text = T) +\n  guides(color = \"none\") +\n  theme_minimal() + \n  geom_dag_point() +\n  geom_dag_text() +\n  geom_dag_edges() +\n  geom_dag_label_repel(aes(label = label))\n```\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n------------------------------------------------------------------------\n\n## Naive based Estimate\n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-2_3a94f27d01e40ab35aeb73290243f497'}\n\n```{.r .cell-code}\napp_data <- readRDS(\"../../data/rand_enc.rds\")\nsummary(app_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>     rand_enc         used_ftr       time_spent    \n#>  Min.   :0.0000   Min.   :0.000   Min.   :-1.625  \n#>  1st Qu.:0.0000   1st Qu.:0.000   1st Qu.:17.782  \n#>  Median :1.0000   Median :0.000   Median :22.869  \n#>  Mean   :0.5068   Mean   :0.408   Mean   :23.286  \n#>  3rd Qu.:1.0000   3rd Qu.:1.000   3rd Qu.:28.817  \n#>  Max.   :1.0000   Max.   :1.000   Max.   :47.948\n```\n:::\n\n```{.r .cell-code}\nhead(app_data)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"rand_enc\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"used_ftr\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"time_spent\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"0\",\"2\":\"1\",\"3\":\"30.51346\"},{\"1\":\"0\",\"2\":\"0\",\"3\":\"19.78372\"},{\"1\":\"1\",\"2\":\"1\",\"3\":\"28.59107\"},{\"1\":\"0\",\"2\":\"0\",\"3\":\"18.63635\"},{\"1\":\"0\",\"2\":\"0\",\"3\":\"14.55074\"},{\"1\":\"1\",\"2\":\"0\",\"3\":\"12.41954\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-3_c31245ddc5da934ac837139b443ed71d'}\n\n```{.r .cell-code}\nnaive_estimate <- lm(time_spent ~ used_ftr, data = app_data)\nsummary(naive_estimate)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = time_spent ~ used_ftr, data = app_data)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -20.4950  -3.5393   0.0158   3.5961  20.5051 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept) 18.86993    0.06955   271.3   <2e-16 ***\n#> used_ftr    10.82269    0.10888    99.4   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 5.351 on 9998 degrees of freedom\n#> Multiple R-squared:  0.497,\tAdjusted R-squared:  0.497 \n#> F-statistic:  9881 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n------------------------------------------------------------------------\n\n## Test the assumption (Encouragement)\n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-4_abded3dc4a94a57857aeba6c35fae049'}\n\n```{.r .cell-code}\ncor(app_data$rand_enc, app_data$used_ftr)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 0.204411\n```\n:::\n\n```{.r .cell-code}\ncor(app_data$rand_enc, app_data$time_spent)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 0.1296716\n```\n:::\n:::\n\n\n-   There seems to be a strong naive estimate relationship between the pop feature usage and the app time, based on the calculations from above.\n\n-   Additionally, there seems to be a positive relationship between the random encouragement and the pop feature, suggesting that the instrument (random encouragement) was relevant. Similarly, there seems to be a relationship as well between the random encouragement and the time spent, but it's not as significant as the former correlation. This can also be validated, as the random encouragement should not have a significant impact on the time spent by the users on the application.\n\n------------------------------------------------------------------------\n\n## Estimate using 2SLS\n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-5_87b8f5d913dd9bb930ad8b4a6dac2da1'}\n\n```{.r .cell-code}\nlibrary(AER)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Loading required package: car\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Loading required package: carData\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Loading required package: lmtest\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Loading required package: zoo\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attaching package: 'zoo'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> The following objects are masked from 'package:base':\n#> \n#>     as.Date, as.Date.numeric\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Loading required package: sandwich\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Loading required package: survival\n```\n:::\n\n```{.r .cell-code}\niv_estimate <- ivreg(time_spent ~ used_ftr | rand_enc, data = app_data)\nsummary(iv_estimate)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> ivreg(formula = time_spent ~ used_ftr | rand_enc, data = app_data)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -20.937  -3.622   0.061   3.568  20.063 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)  19.3124     0.2249   85.86   <2e-16 ***\n#> used_ftr      9.7382     0.5353   18.19   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 5.377 on 9998 degrees of freedom\n#> Multiple R-Squared: 0.4921,\tAdjusted R-squared: 0.492 \n#> Wald test:   331 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n-   The Naive estimate is 10.82, while the IV estimate is 9.73. The naive estimate shows an upward bias as it does not account for unobserved confounders that are related to the feature use and the time spent on the application which is the encouragement. While the IV estimates do take this into account, therefore the estimate was slightly lower. The naive estimate captures not just the effect of the feature usage on the time spent on the application, but also the encouragement, which leads to an overestimate.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}